<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control AK: Minimal Discipline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        :root {
            --bg-deep: #050505;
            --ak-green: #22c55e;
            --ak-purple: #a855f7;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            color: #e5e7eb;
            letter-spacing: -0.01em;
        }

        .soft-glass {
            background: rgba(18, 18, 18, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 2rem;
        }

        .sidebar-item {
            border-radius: 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-item.active {
            background: rgba(34, 197, 94, 0.1);
            color: var(--ak-green);
        }

        .btn-primary {
            background: var(--ak-green);
            color: #000;
            border-radius: 1.25rem;
            transition: all 0.3s ease;
            font-weight: 700;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(34, 197, 94, 0.3);
            filter: brightness(1.1);
        }

        .card-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1.5rem;
            transition: all 0.2s ease;
        }

        .card-item:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.04);
        }

        /* Estilo para inputs y textareas */
        input, textarea {
            background: rgba(255, 255, 255, 0.03) !important;
            border-radius: 1rem !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            transition: all 0.3s ease !important;
        }

        input:focus, textarea:focus {
            border-color: var(--ak-green) !important;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1) !important;
            outline: none;
        }

        /* Scrollbar minimalista */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-float { animation: float 6s ease-in-out infinite; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row p-4 gap-4 overflow-hidden">

    <!-- Sidebar con estilo flotante y redondeado -->
    <aside class="w-full md:w-80 soft-glass flex flex-col p-6 z-20">
        <div class="mb-10 px-2 flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-green-600 to-purple-600 flex items-center justify-center font-extrabold text-black">AK</div>
            <div>
                <h1 class="text-xl font-extrabold tracking-tight">CONTROL <span class="text-green-500">AK</span></h1>
                <p class="text-[10px] text-purple-400 font-semibold uppercase tracking-widest opacity-70">Sintetizador Personal</p>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto space-y-2" id="sidebarTabs">
            <!-- Tabs dinámicas -->
        </nav>

        <div class="mt-auto pt-6 space-y-3">
            <button onclick="viewFailures()" class="w-full py-3 rounded-2xl text-[11px] font-bold text-red-400 hover:bg-red-500/10 transition-all flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                REGISTRO DE FALLOS
            </button>
            <button onclick="openNewBoardModal()" class="w-full btn-primary py-4 text-sm shadow-lg">
                Nuevo Núcleo
            </button>
        </div>
    </aside>

    <!-- Área de Trabajo Principal -->
    <main class="flex-1 soft-glass flex flex-col p-8 md:p-12 relative overflow-hidden">
        <!-- Decoración de fondo suave -->
        <div class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-purple-600/10 rounded-full blur-[120px] pointer-events-none"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-96 h-96 bg-green-600/10 rounded-full blur-[120px] pointer-events-none"></div>
        
        <header id="boardHeader" class="mb-12 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 z-10">
            <!-- Header dinámico -->
        </header>

        <div id="boardContent" class="flex-1 flex flex-col z-10 overflow-y-auto">
            <!-- Contenido dinámico -->
        </div>
    </main>

    <!-- Empty State con estética minimalista -->
    <template id="emptyStateTemplate">
        <div class="flex-1 flex flex-col items-center justify-center text-center animate-fade py-20">
            <div class="w-24 h-24 rounded-[2rem] bg-neutral-900 flex items-center justify-center mb-8 animate-float">
                <svg class="w-10 h-10 text-neutral-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
            </div>
            <h2 class="text-2xl font-bold text-white mb-3">Núcleo listo para inicializar</h2>
            <p class="max-w-xs text-neutral-500 text-sm leading-relaxed">
                Selecciona un proyecto a la izquierda o crea uno nuevo para empezar a estructurar tu disciplina.
            </p>
        </div>
    </template>

    <!-- MODALES: Redondeados y suaves -->
    <div id="failuresModal" class="fixed inset-0 bg-black/80 backdrop-blur-xl z-[60] hidden flex items-center justify-center p-6">
        <div class="soft-glass max-w-2xl w-full p-10 shadow-2xl flex flex-col bg-neutral-950/90">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h3 class="text-2xl font-bold text-white">Anomalías Detectadas</h3>
                    <p class="text-neutral-500 text-sm mt-1">Sistemas que no alcanzaron el 100% de efectividad.</p>
                </div>
                <button onclick="closeFailures()" class="p-2 hover:bg-white/5 rounded-full transition-colors">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <div id="failuresList" class="flex-1 overflow-y-auto space-y-4 pr-2"></div>
            <div class="mt-8 pt-6 border-t border-white/5 flex justify-between items-center">
                <button onclick="clearFailures()" class="text-xs font-semibold text-neutral-600 hover:text-red-400 transition-colors uppercase tracking-widest">Borrar historial</button>
                <button onclick="closeFailures()" class="bg-white/5 hover:bg-white/10 px-8 py-3 rounded-2xl text-sm font-bold transition-all">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Núcleo -->
    <div id="newBoardModal" class="fixed inset-0 bg-black/80 backdrop-blur-xl z-50 hidden flex items-center justify-center p-6">
        <div class="soft-glass max-w-md w-full p-10 shadow-2xl bg-neutral-950/90">
            <h3 class="text-xl font-bold mb-8 text-white">Configurar Nuevo Núcleo</h3>
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] text-neutral-500 font-bold uppercase tracking-widest mb-3 block">Identificador</label>
                    <input type="text" id="newBoardTitle" placeholder="Nombre del proyecto..." class="w-full px-5 py-4 text-white font-medium">
                </div>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="selectMode('basic')" class="mode-btn p-5 card-item text-left group" id="mode-basic">
                        <span class="block font-bold text-white text-sm mb-1 group-hover:text-green-400 transition-colors">Notas Libres</span>
                        <span class="text-xs text-neutral-500">Escritura sin restricciones</span>
                    </button>
                    <button onclick="selectMode('goals')" class="mode-btn p-5 card-item text-left group" id="mode-goals">
                        <span class="block font-bold text-white text-sm mb-1 group-hover:text-green-400 transition-colors">Objetivos Binarios</span>
                        <span class="text-xs text-neutral-500">Listas de cumplimiento diario</span>
                    </button>
                    <button onclick="selectMode('limit')" class="mode-btn p-5 card-item text-left group" id="mode-limit">
                        <span class="block font-bold text-white text-sm mb-1 group-hover:text-purple-400 transition-colors">Límites Lógicos</span>
                        <span class="text-xs text-neutral-500">Protocolos SÍ / NO</span>
                    </button>
                </div>
                <div class="flex gap-4 pt-4">
                    <button onclick="closeNewBoardModal()" class="flex-1 py-4 text-neutral-500 font-bold text-xs uppercase hover:text-white transition-colors">Cancelar</button>
                    <button onclick="createNewBoard()" class="flex-1 btn-primary py-4 text-xs uppercase shadow-green-900/20">Inicializar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificación Minimalista -->
    <div id="toast" class="fixed bottom-10 right-10 bg-white text-black p-5 rounded-[1.5rem] hidden shadow-2xl z-[100] transform translate-y-20 transition-all duration-500">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
            </div>
            <p class="text-sm font-bold" id="toastText"></p>
        </div>
    </div>

    <script>
        // Lógica de datos (IDEM a la anterior, pero con UI actualizada)
        let boards = JSON.parse(localStorage.getItem('ctrl_ak_boards')) || [];
        let failures = JSON.parse(localStorage.getItem('ctrl_ak_failures')) || [];
        let lastDate = localStorage.getItem('ctrl_ak_date') || new Date().toDateString();
        let activeBoardId = localStorage.getItem('ctrl_ak_active') || null;
        let selectedMode = 'limit';

        window.onload = () => {
            checkDayTransition();
            renderSidebar();
            renderContent();
        };

        function save() { 
            localStorage.setItem('ctrl_ak_boards', JSON.stringify(boards));
            localStorage.setItem('ctrl_ak_failures', JSON.stringify(failures));
        }

        function checkDayTransition() {
            const today = new Date().toDateString();
            if (today !== lastDate) {
                archiveIncompletes(lastDate);
                localStorage.setItem('ctrl_ak_date', today);
                save();
            }
        }

        function archiveIncompletes(failedDate) {
            boards.forEach(b => {
                let items = [];
                if (b.mode === 'goals') {
                    items = b.content.filter(i => !i.completed).map(i => i.text);
                    b.content.forEach(i => i.completed = false);
                } else if (b.mode === 'limit') {
                    items = [
                        ...b.content.do.filter(i => !i.completed).map(i => `SÍ: ${i.text}`),
                        ...b.content.dont.filter(i => !i.completed).map(i => `NO: ${i.text}`)
                    ];
                    b.content.do.forEach(i => i.completed = false);
                    b.content.dont.forEach(i => i.completed = false);
                }
                if (items.length > 0) failures.push({ date: failedDate, board: b.title, items });
            });
        }

        function renderSidebar() {
            const container = document.getElementById('sidebarTabs');
            if (boards.length === 0) {
                container.innerHTML = `<div class="py-10 text-center text-neutral-600 text-xs">Sin núcleos activos</div>`;
                return;
            }
            container.innerHTML = boards.map(b => `
                <div class="sidebar-item group px-5 py-4 cursor-pointer flex justify-between items-center ${activeBoardId == b.id ? 'active' : 'hover:bg-white/5 text-neutral-400'}" 
                     onclick="switchBoard(${b.id})">
                    <div class="flex flex-col truncate">
                        <span class="font-bold text-sm truncate">${b.title}</span>
                        <span class="text-[10px] opacity-50 mt-1 uppercase font-semibold tracking-wider">${b.mode}</span>
                    </div>
                    <button onclick="event.stopPropagation(); deleteBoard(${b.id})" class="opacity-0 group-hover:opacity-100 p-1 hover:text-red-500 transition-all">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
            `).join('');
        }

        function renderContent() {
            const container = document.getElementById('boardContent');
            const header = document.getElementById('boardHeader');
            const board = boards.find(b => b.id == activeBoardId);

            if (!board) {
                header.innerHTML = "";
                container.innerHTML = document.getElementById('emptyStateTemplate').innerHTML;
                return;
            }

            header.innerHTML = `
                <div class="flex-1">
                    <h2 class="text-4xl font-extrabold tracking-tight text-white mb-2">${board.title}</h2>
                    <div class="flex gap-4 items-center">
                        <span class="px-3 py-1 bg-purple-500/10 text-purple-400 text-[10px] font-bold rounded-full uppercase tracking-widest">${board.mode}</span>
                        <span class="text-neutral-600 text-xs font-medium">Protocolo de ejecución activa</span>
                    </div>
                </div>
                <div class="flex items-center gap-6 p-4 rounded-3xl bg-white/5 border border-white/5">
                    <div class="flex flex-col">
                        <span class="text-[9px] text-neutral-500 font-bold uppercase mb-1">Check-in</span>
                        <input type="time" value="${board.config.time}" onchange="updateConfig(${board.id}, 'time', this.value)"
                               class="bg-transparent text-white font-bold border-none text-xl p-0 focus:ring-0">
                    </div>
                    <div class="w-[1px] h-10 bg-white/5"></div>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" ${board.config.notify ? 'checked' : ''} onchange="updateConfig(${board.id}, 'notify', this.checked)"
                               class="w-6 h-6 rounded-xl border-none bg-neutral-800 text-green-500 focus:ring-0 transition-all">
                        <span class="text-[10px] font-bold text-neutral-400 uppercase">Alertas</span>
                    </label>
                </div>
            `;

            if (board.mode === 'basic') {
                container.innerHTML = `<textarea oninput="updateBasic(${board.id}, this.value)" class="w-full h-full p-10 text-lg font-medium leading-relaxed resize-none text-neutral-300" placeholder="Empieza a escribir...">${board.content || ''}</textarea>`;
            } else if (board.mode === 'goals') {
                container.innerHTML = `<div class="max-w-2xl mx-auto w-full">
                    <div class="flex gap-3 mb-12">
                        <input type="text" id="goalAdd" placeholder="Definir nuevo objetivo..." class="flex-1 px-6 py-4">
                        <button onclick="addGoal(${board.id})" class="btn-primary px-8">Añadir</button>
                    </div>
                    <ul class="space-y-3">${board.content.map(i => renderItemUI(board.id, i)).join('')}</ul>
                </div>`;
            } else {
                container.innerHTML = `<div class="grid grid-cols-1 lg:grid-cols-2 gap-12 h-full">
                    <div class="flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xs font-extrabold text-green-500 uppercase tracking-widest">Compromisos (SÍ)</h3>
                            <span class="text-[10px] text-neutral-600 font-bold">${board.content.do.length} REGLAS</span>
                        </div>
                        <div class="flex gap-2 mb-6">
                            <input type="text" id="doAdd" class="flex-1 px-4 py-3 text-sm">
                            <button onclick="addLimit(${board.id}, 'do')" class="bg-white/5 hover:bg-white/10 px-4 rounded-xl text-green-500 font-bold transition-all">+</button>
                        </div>
                        <ul class="space-y-2 overflow-y-auto">${board.content.do.map(i => renderItemUI(board.id, i, 'do')).join('')}</ul>
                    </div>
                    <div class="flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xs font-extrabold text-purple-500 uppercase tracking-widest">Restricciones (NO)</h3>
                            <span class="text-[10px] text-neutral-600 font-bold">${board.content.dont.length} REGLAS</span>
                        </div>
                        <div class="flex gap-2 mb-6">
                            <input type="text" id="dontAdd" class="flex-1 px-4 py-3 text-sm">
                            <button onclick="addLimit(${board.id}, 'dont')" class="bg-white/5 hover:bg-white/10 px-4 rounded-xl text-purple-500 font-bold transition-all">+</button>
                        </div>
                        <ul class="space-y-2 overflow-y-auto">${board.content.dont.map(i => renderItemUI(board.id, i, 'dont')).join('')}</ul>
                    </div>
                </div>`;
            }
        }

        function renderItemUI(bid, i, type = null) {
            return `
                <li class="card-item p-5 flex justify-between items-center group">
                    <div class="flex items-center gap-5 cursor-pointer flex-1" onclick="toggleItem(${bid}, ${iid = i.id}, '${type}')">
                        <div class="w-6 h-6 rounded-lg border-2 border-neutral-800 flex items-center justify-center transition-all ${i.completed ? 'bg-green-500 border-green-500' : ''}">
                            ${i.completed ? '<svg class="w-4 h-4 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-width="4" d="M5 13l4 4L19 7"/></svg>' : ''}
                        </div>
                        <span class="${i.completed ? 'line-through text-neutral-600' : 'text-neutral-200'} text-sm font-semibold transition-all">${i.text}</span>
                    </div>
                    <button onclick="deleteItem(${bid}, ${i.id}, '${type}')" class="opacity-0 group-hover:opacity-100 text-neutral-700 hover:text-red-500 transition-all">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </li>
            `;
        }

        // --- FUNCIONALIDADES CORE ---
        function switchBoard(id) { activeBoardId = id; localStorage.setItem('ctrl_ak_active', id); renderSidebar(); renderContent(); }
        function deleteBoard(id) { boards = boards.filter(x => x.id != id); if(activeBoardId == id) activeBoardId = null; save(); renderSidebar(); renderContent(); }
        function updateConfig(id, k, v) { const b = boards.find(x => x.id == id); b.config[k] = v; save(); }
        function updateBasic(id, v) { boards.find(x=>x.id==id).content = v; save(); }
        
        function addGoal(id) {
            const input = document.getElementById('goalAdd');
            if(!input.value.trim()) return;
            boards.find(x=>x.id==id).content.push({id:Date.now(), text:input.value, completed:false});
            input.value = ""; save(); renderContent();
        }

        function addLimit(id, type) {
            const input = document.getElementById(`${type}Add`);
            if(!input.value.trim()) return;
            boards.find(x=>x.id==id).content[type].push({id:Date.now(), text:input.value, completed:false});
            input.value = ""; save(); renderContent();
        }

        function toggleItem(bid, iid, type) {
            const b = boards.find(x=>x.id==bid);
            let item;
            if(!type || type === 'null') item = b.content.find(x=>x.id==iid);
            else item = b.content[type].find(x=>x.id==iid);
            if(item) item.completed = !item.completed;
            save(); renderContent();
        }

        function deleteItem(bid, iid, type) {
            const b = boards.find(x=>x.id==bid);
            if(!type || type === 'null') b.content = b.content.filter(x=>x.id!=iid);
            else b.content[type] = b.content[type].filter(x=>x.id!=iid);
            save(); renderContent();
        }

        // --- MODALES ---
        function openNewBoardModal() { document.getElementById('newBoardModal').classList.remove('hidden'); selectMode('goals'); }
        function closeNewBoardModal() { document.getElementById('newBoardModal').classList.add('hidden'); }
        function selectMode(m) { selectedMode = m; document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('border-green-500', 'bg-green-500/5')); document.getElementById(`mode-${m}`).classList.add('border-green-500', 'bg-green-500/5'); }
        
        function createNewBoard() {
            const t = document.getElementById('newBoardTitle').value.trim();
            if(!t) return;
            const nb = { 
                id: Date.now(), 
                title: t, 
                mode: selectedMode, 
                content: selectedMode === 'basic' ? '' : (selectedMode === 'limit' ? { do: [], dont: [] } : []), 
                config: { notify: true, time: "08:00" } 
            };
            boards.push(nb); activeBoardId = nb.id; save(); closeNewBoardModal(); renderSidebar(); renderContent();
        }

        function viewFailures() {
            const modal = document.getElementById('failuresModal');
            const list = document.getElementById('failuresList');
            modal.classList.remove('hidden');
            if (failures.length === 0) {
                list.innerHTML = `<div class="py-20 text-center text-neutral-700 font-bold uppercase tracking-widest text-xs">Integridad Total del Sistema</div>`;
            } else {
                list.innerHTML = failures.map(f => `
                    <div class="card-item p-6 border-red-500/10">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs font-bold text-red-400">${f.date}</span>
                            <span class="text-[10px] text-neutral-600 font-bold uppercase">${f.board}</span>
                        </div>
                        <ul class="space-y-2">
                            ${f.items.map(i => `<li class="text-neutral-400 text-xs flex items-center gap-3"><div class="w-1.5 h-1.5 rounded-full bg-red-500/50"></div>${i}</li>`).join('')}
                        </ul>
                    </div>
                `).reverse().join('');
            }
        }
        function closeFailures() { document.getElementById('failuresModal').classList.add('hidden'); }
        function clearFailures() { if(confirm("¿Eliminar registros permanentes?")) { failures = []; save(); viewFailures(); } }
    </script>
</body>
</html>